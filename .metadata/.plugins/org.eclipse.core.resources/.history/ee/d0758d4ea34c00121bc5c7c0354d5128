package com.vestrel00.nekko.actors.components;

import com.badlogic.gdx.graphics.g2d.TextureAtlas;
import com.badlogic.gdx.graphics.g2d.TextureAtlas.AtlasRegion;
import com.badlogic.gdx.utils.TimeUtils;
import com.vestrel00.nekko.KFNekko;
import com.vestrel00.nekko.actors.CuteMonster;
import com.vestrel00.nekko.actors.states.FaceState;

public class CuteMonsterSprite extends Sprite {

	// animation frames
	private AtlasRegion[] idle, move, attack, hurt, jump;

	public int idleIndex = 0, walkIndex = 0, jumpIndex = 0, combatIndex = 0;

	private CuteMonster monster;

	public CuteMonsterSprite(CuteMonster monster, TextureAtlas atlas) {
		super(monster);
		this.monster = monster;
		initTextures(atlas);
	}

	private void initTextures(TextureAtlas atlas) {
		hurt = new AtlasRegion[2];
		idle = new AtlasRegion[4];
		move = new AtlasRegion[5];
		attack = new AtlasRegion[6];
		jump = new AtlasRegion[8];

		hurt[0] = atlas.findRegion("cuteMonsterHurt1");
		hurt[1] = atlas.findRegion("cuteMonsterHurt2");
		int i = 0;
		for (i = 0; i < idle.length; i++)
			idle[i] = atlas.findRegion("cuteMonsterIdle" + String.valueOf(i));
		for (i = 0; i < move.length; i++)
			move[i] = atlas.findRegion("cuteMonsterMove" + String.valueOf(i));
		for (i = 0; i < attack.length; i++)
			attack[i] = atlas.findRegion("cuteMonsterAttack"
					+ String.valueOf(i));
		for (i = 0; i < jump.length; i++)
			jump[i] = atlas.findRegion("cuteMonsterJump" + String.valueOf(i));
	}

	@Override
	public void update() {
		if (TimeUtils.nanoTime() - lastAnimationTime < animationDelay)
			return;
		lastAnimationTime = TimeUtils.nanoTime();

		xScale = (monster.faceState == FaceState.LEFT) ? -1.0f : 1.0f;

		// animate
		if (switchCombatState())
			return;
		if (switchVerticalMotionState())
			return;

		switchHorizontalMotionState();
	}

	private boolean switchCombatState() {
		switch (monster.combatState) {
		case IDLE:
			return false;
		case ATTACK:
			if (++combatIndex == attack.length) {
				combatIndex = 0;
				monster.onDeactivateCombat();
			}
			if (combatIndex == 7) {
				monster.attack(KFNekko.enemies, 1, false);
				activateEffect();
			}
			currentTexture = spinKick[combatIndex];
			animationDelay = 40000000L;
			return true;
		}
	}

	private boolean switchVerticalMotionState() {
		// TODO Auto-generated method stub
		return false;
	}

	private void switchHorizontalMotionState() {
		// TODO Auto-generated method stub

	}

}
